# ğŸª Bookstore Microservices API

Un sistema de microservicios simple para gestionar una librerÃ­a, construido con **NestJS**, **Prisma** y **arquitectura Hexagonal + Clean + DDD**. Incluye dos servicios independientes:

- ğŸ“š **Books Service** â†’ GestiÃ³n de libros.
- ğŸ›’ **Orders Service** â†’ GestiÃ³n de Ã³rdenes, validando libros a travÃ©s del servicio de Books vÃ­a HTTP.

---

## ğŸ“‘ Tabla de Contenidos
- [ğŸ“Œ DescripciÃ³n General](#-descripciÃ³n-general)
- [ğŸ—ï¸ Arquitectura del Sistema](#ï¸-arquitectura-del-sistema)
  - [ğŸŒ Diagrama general](#-diagrama-general)
- [ğŸ§° Stack TecnolÃ³gico](#-stack-tecnolÃ³gico)
- [âš™ï¸ Requisitos Previos](#-requisitos-previos)
- [ğŸš€ InstalaciÃ³n & EjecuciÃ³n](#-instalaciÃ³n--ejecuciÃ³n)
  - [ğŸ³ Docker Compose](#-docker-compose)
  - [ğŸ’» EjecuciÃ³n local](#-ejecuciÃ³n-local)
- [ğŸ“ Endpoints Principales](#-endpoints-principales)
- [ğŸ”§ Variables de Entorno](#-variables-de-entorno)
- [ğŸ› ï¸ Decisiones de Arquitectura](#-decisiones-de-arquitectura)
- [ğŸ“š DocumentaciÃ³n Detallada](#-documentaciÃ³n-detallada)
- [ğŸ‘¨â€ğŸ’» Autor](#-autor)
- [ğŸ“„ Licencia](#-licencia)

---

## ğŸ“Œ DescripciÃ³n General

Este sistema implementa dos microservicios independientes que se comunican vÃ­a **HTTP** siguiendo principios de **arquitectura de microservicios**:

- **Books Service** â†’ permite crear, leer y buscar libros.
- **Orders Service** â†’ permite crear y listar Ã³rdenes. Antes de crear una orden, valida la existencia del libro llamando al Books Service.

Cada servicio tiene **su propio schema en una base de datos compartida** y no acceden a los schemas de otros servicios.

### âœ¨ CaracterÃ­sticas Principales

- **Arquitectura desacoplada**: Cada servicio maneja su propio dominio de negocio
- **ComunicaciÃ³n asÃ­ncrona**: HTTP/REST entre servicios sin dependencias directas de base de datos
- **Tolerancia a fallos**: Manejo de errores de red y timeouts entre servicios
- **Escalabilidad**: Cada servicio puede desplegarse y escalarse independientemente
- **DocumentaciÃ³n automÃ¡tica**: Swagger UI integrado en cada servicio

---

## ğŸ—ï¸ Arquitectura del Sistema

### ğŸ“‚ Estructura de directorios

```
.
â”œâ”€â”€ books-service/        # Microservicio de libros
â”œâ”€â”€ orders-service/       # Microservicio de Ã³rdenes
â”œâ”€â”€ docker-compose.yml    # OrquestaciÃ³n de servicios
â””â”€â”€ README.md             # DocumentaciÃ³n raÃ­z
```

### ğŸŒ Diagrama general

```mermaid
flowchart TB
    subgraph External["ğŸŒ Clientes"]
        UI[Web UI / Postman]
        SWAGGER[Swagger UI]
        CURL[cURL / API Clients]
    end

    subgraph BooksService["ğŸ“š Books Microservice (Port 3000)"]
        subgraph BooksInfra["ğŸŒ Interfaces Layer"]
            BookController["BookController<br/>@Controller<br/>â€¢ GET /books<br/>â€¢ GET /books/:id<br/>â€¢ POST /books"]
            BookDTO["DTOs<br/>â€¢ CreateBookDto<br/>â€¢ GetBookDto"]
        end

        subgraph BooksApp["âš™ï¸ Application Layer"]
            BookUseCases["Use Cases<br/>â€¢ CreateBookUseCase<br/>â€¢ GetBookByIdUseCase<br/>â€¢ ListBooksUseCase"]
        end

        subgraph BooksDomain["ğŸ› ï¸ Domain Layer"]
            BookEntity["Book Entity<br/>â€¢ id, title, author<br/>â€¢ price, currency, stock<br/>â€¢ Factory methods"]
            BookRepoPort["BookRepository<br/>Interface (Port)"]
        end

        subgraph BooksInfraImpl["ğŸ”§ Infrastructure Layer"]
            PrismaBookRepo["PrismaBookRepository<br/>Adapter"]
            PrismaBooks["PrismaService"]
        end
    end

    subgraph OrdersService["ğŸ›’ Orders Microservice (Port 3001)"]
        subgraph OrdersInfra["ğŸŒ Interfaces Layer"]
            OrderController["OrderController<br/>@Controller<br/>â€¢ GET /orders<br/>â€¢ POST /orders"]
            OrderDTO["DTOs<br/>â€¢ CreateOrderDto<br/>â€¢ ListOrdersDto"]
        end

        subgraph OrdersApp["âš™ï¸ Application Layer"]
            OrderUseCases["Use Cases<br/>â€¢ CreateOrderUseCase<br/>â€¢ ListOrdersUseCase"]
        end

        subgraph OrdersDomain["ğŸ› ï¸ Domain Layer"]
            OrderEntity["Order Entity<br/>â€¢ id, bookId, quantity<br/>â€¢ totalAmount, status<br/>â€¢ Factory methods"]
            OrderRepoPort["OrderRepository<br/>Interface (Port)"]
        end

        subgraph OrdersInfraImpl["ğŸ”§ Infrastructure Layer"]
            PrismaOrderRepo["PrismaOrderRepository<br/>Adapter"]
            PrismaOrders["PrismaService"]
            BooksHttpClient["BooksHttpClient<br/>Axios Adapter"]
        end
    end

    subgraph Database["ğŸ—„ï¸ PostgreSQL"]
        BooksSchema[("books schema<br/>â€¢ book table")]
        OrdersSchema[("orders schema<br/>â€¢ order table")]
    end

    %% Client connections
    External --> BookController
    External --> OrderController

    %% Books Service internal flow
    BookController --> BookDTO
    BookController --> BookUseCases
    BookUseCases --> BookRepoPort
    BookUseCases --> BookEntity
    BookRepoPort -.implements.-> PrismaBookRepo
    PrismaBookRepo --> PrismaBooks
    PrismaBooks --> BooksSchema

    %% Orders Service internal flow
    OrderController --> OrderDTO
    OrderController --> OrderUseCases
    OrderUseCases --> OrderRepoPort
    OrderUseCases --> OrderEntity
    OrderUseCases --> BooksHttpClient
    OrderRepoPort -.implements.-> PrismaOrderRepo
    PrismaOrderRepo --> PrismaOrders
    PrismaOrders --> OrdersSchema

    %% Inter-service communication
    BooksHttpClient -.->|HTTP GET /books/:id| BookController

    %% Styling
    classDef microservice fill:#e3f2fd,stroke:#1976d2,stroke-width:3px
    classDef interfaces fill:#fff3e0,stroke:#f57c00,stroke-width:2px
    classDef application fill:#e8f5e8,stroke:#388e3c,stroke-width:2px
    classDef domain fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
    classDef infrastructure fill:#fce4ec,stroke:#c2185b,stroke-width:2px
    classDef external fill:#f1f8e9,stroke:#689f38,stroke-width:2px
    classDef database fill:#e0f2f1,stroke:#00796b,stroke-width:2px

    class BooksService,OrdersService microservice
    class BooksInfra,OrdersInfra interfaces
    class BooksApp,OrdersApp application
    class BooksDomain,OrdersDomain domain
    class BooksInfraImpl,OrdersInfraImpl infrastructure
    class External external
    class Database database
```

---

## ğŸ§° Stack TecnolÃ³gico

| Componente | TecnologÃ­a | VersiÃ³n |
|------------|------------|---------|
| Runtime | Node.js | v22 |
| Framework | NestJS | Latest |
| Lenguaje | TypeScript | Latest |
| ORM | Prisma | Latest |
| Base de datos | PostgreSQL | 17 |
| HTTP Client | Axios | Latest |
| DocumentaciÃ³n | Swagger/OpenAPI | Latest |
| ContainerizaciÃ³n | Docker & Docker Compose | Latest |

---

## âš™ï¸ Requisitos Previos

- Node.js v22
- Docker & Docker Compose
- PostgreSQL (opcional si no usas Docker)

---

## ğŸš€ InstalaciÃ³n & EjecuciÃ³n

Clona el repositorio junto a sus submÃ³dulos y entra al directorio:

```bash
git clone --recurse-submodules git@github.com:SebastianBC09/Bookstore-microservice-system.git
cd Bookstore-microservice-system
```

### ğŸ³ Docker Compose

**OpciÃ³n recomendada** - Levanta todo el sistema con un comando:

```bash
docker-compose up --build
```

Esto iniciarÃ¡:
- Books Service en `http://localhost:3000`
- Orders Service en `http://localhost:3001`
- PostgreSQL con ambos schemas
- Swagger UI disponible en cada servicio

### ğŸ’» EjecuciÃ³n local (sin Docker)

1. Configurar variables de entorno en cada servicio
2. Instalar dependencias: `npm install` en cada carpeta
3. Ejecutar migraciones de Prisma en cada servicio
4. Levantar cada servicio: `npm run start:dev`

---

## ğŸ“ Endpoints Principales

### ğŸ“š Books Service (Puerto 3000)
- `GET /books` - Lista todos los libros
- `GET /books/:id` - Obtiene un libro por ID
- `POST /books` - Crea un nuevo libro
- `GET /api/docs` - DocumentaciÃ³n Swagger

### ğŸ›’ Orders Service (Puerto 3001)
- `GET /orders` - Lista todas las Ã³rdenes
- `POST /orders` - Crea una nueva orden
- `GET /api/docs` - DocumentaciÃ³n Swagger

## ğŸ”§ Variables de Entorno

Cada servicio requiere su propio archivo `.env`:

### Books Service
```env
DATABASE_URL="postgresql://user:password@localhost:5432/bookstore?schema=books"
PORT=3000
```

### Orders Service
```env
DATABASE_URL="postgresql://user:password@localhost:5432/bookstore?schema=orders"
BOOKS_SERVICE_URL="http://localhost:3000"
PORT=3001
```

---

## ğŸ› ï¸ Decisiones de Arquitectura

### ğŸ›ï¸ Patrones Implementados
- **Arquitectura Hexagonal**: SeparaciÃ³n clara entre `domain`, `application`, `infrastructure` e `interfaces`
- **Clean Architecture**: Dependencias apuntan hacia el dominio
- **Domain Driven Design**: Entidades y agregados bien definidos
- **Repository Pattern**: AbstracciÃ³n de acceso a datos
- **Factory Pattern**: CreaciÃ³n controlada de entidades

### ğŸ”— ComunicaciÃ³n entre Servicios
- **HTTP/REST**: ComunicaciÃ³n sÃ­ncrona entre microservicios
- **No shared database**: Cada servicio maneja su propio schema
- **Error handling**: Manejo robusto de fallos de red y timeouts

### ğŸ¯ Principios Aplicados
- **Single Responsibility**: Cada servicio tiene una responsabilidad clara
- **Dependency Inversion**: Uso de interfaces y puertos/adaptadores
- **Open/Closed**: Extensible sin modificar cÃ³digo existente

---

## ğŸ“š DocumentaciÃ³n Detallada

Para informaciÃ³n especÃ­fica de implementaciÃ³n, consulta los READMEs de cada servicio:

- [ğŸ“š Books Service README](./books-service/README.md)
- [ğŸ›’ Orders Service README](./orders-service/README.md)

---

## ğŸ‘¨â€ğŸ’» Autor

**Sebastian Ballen C** - _FullStack Developer_

- LinkedIn: [Sebastian B.](https://www.linkedin.com/in/sebastianballencastaneda-softwaredeveloper)
- Email: sebastian.ballenc@gmail.com

---

## ğŸ“„ Licencia

Este proyecto estÃ¡ licenciado bajo la Licencia MIT - vea el archivo [LICENSE](LICENSE) para mÃ¡s detalles.

---

â­ï¸ **Si te resulta Ãºtil este proyecto, Â¡no olvides darle una estrella en GitHub!** â­ï¸
